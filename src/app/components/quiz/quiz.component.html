<div class="quiz-container">
  @if (isLoading()) {
  <div class="loading">
    @if (isGenerating()) {
    Generating today's quiz questions...
    } @else {
    Loading today's quiz...
    }
  </div>
  } @else if (isCompleted()) {
  <div class="completed-message">
    <div class="completed-icon">‚úì</div>
    <h2>You've already completed today's quiz!</h2>
    <p class="completed-text">
      Great job! You've finished all 5 questions for today.
    </p>
    <p class="next-quiz-text">
      üéØ Keep your momentum going! New questions await you tomorrow to continue building your knowledge! üí™
    </p>
  </div>
  } @else if (currentQuestion()) {
  <div class="quiz-content">
    <div class="quiz-tagline">
      <div class="tagline-title">
        <app-icon name="flag" [size]="28" class="flag-icon" aria-label="American flag"></app-icon>
        Citizenship Daily
        <span class="statue-icon">üóΩ</span>
      </div>
      <div class="tagline-text">Whether you're already American or working on it</div>
    </div>
    <div class="question-header">
      <div class="question-number">Question {{ currentQuestionIndex() + 1 }} of 5</div>
    </div>

    <div class="question-text">
      {{ currentQuestion()?.questionText }}
    </div>

    <div class="options-container">
      @for (option of currentQuestion()?.options; track $index) {
      <button class="option-button" [class.correct]="showFeedback() && isCorrect($index)"
        [class.incorrect]="showFeedback() && isSelected($index) && !isCorrect($index)" [class.disabled]="showFeedback()"
        [disabled]="showFeedback()" (click)="selectAnswer($index)">
        {{ option }}
      </button>
      }
    </div>

    @if (showFeedback()) {
    <div class="feedback-section">
      <div class="feedback-message" [class.correct-feedback]="selectedAnswer() !== null && isCorrect(selectedAnswer()!)"
        [class.incorrect-feedback]="selectedAnswer() !== null && !isCorrect(selectedAnswer()!)">
        @if (selectedAnswer() !== null && isCorrect(selectedAnswer()!)) {
        ‚úì Correct!
        } @else {
        ‚úó Incorrect. The correct answer is: {{ getCorrectAnswerText() }}
        }
      </div>
      <button class="next-button" (click)="nextQuestion()">
        {{ isLastQuestion() ? 'View Results' : 'Next Question' }}
      </button>
    </div>
    }
  </div>
  } @else {
  <div class="error">
    @if (error()) {
    <div class="error-content">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h2>Unable to Load Quiz</h2>
      <p class="error-message">{{ error()!.message }}</p>
      <div class="error-details">
        @if (error()!.type === 'network_error' || error()!.type === 'timeout') {
        <p>Please check your internet connection and try again.</p>
        } @else if (error()!.type === 'generation_failed') {
        <p>The quiz could not be generated. This may be a temporary issue. Please try refreshing the page.</p>
        } @else {
        <p>The quiz is not available. Please try again later or contact support if the issue persists.</p>
        }
        <button class="retry-button" (click)="loadQuiz()" style="margin-top: 16px;">
          Retry
        </button>
      </div>
    </div>
    } @else {
    <p>No quiz available for today.</p>
    <p style="font-size: 14px; margin-top: 12px; color: #6b7280;">
      The quiz could not be loaded. Please try refreshing the page.
    </p>
    <button class="retry-button" (click)="loadQuiz()" style="margin-top: 16px;">
      Retry
    </button>
    }
  </div>
  }
</div>